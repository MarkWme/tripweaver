# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

TripWeaver is a polyglot JFrog-ready demo application for trip planning via natural language queries. It demonstrates a full DevSecOps pipeline with intentional security vulnerabilities to test JFrog tooling.

**Core Components:**
- **Frontend**: Next.js/React app with a simple query interface (`frontend/`)
- **API**: FastAPI Python backend with trip planning logic (`api/`)
- **Seedgen**: .NET 8 CLI tool for data processing (`tools/seedgen/`)
- **Data**: CSV source and JSON index for destinations (`data/`)
- **Infrastructure**: Kubernetes manifests and Helm charts (`infra/`, `charts/`)

## Development Commands

### Local Development
```bash
# Generate data index (required first step)
make seed

# Build all Docker images
make build

# Run full stack locally
make up
# API will be at http://localhost:8000
# Frontend will be at http://localhost:3000

# Run tests across all components
make test

# Generate SBOMs and sign images
make sbom && make sign

# Clean up
make clean
```

### Component-Specific Commands

**API (FastAPI):**
```bash
cd api
python -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
python -m uvicorn app.main:app --reload --port 8000
# Tests: PYTHONPATH=. pytest -q
```

**Frontend (Next.js):**
```bash
cd frontend
npm ci
npm run dev        # Development server
npm run build      # Production build
npm run start      # Production server
npm run test       # Custom test script
```

**Seedgen (.NET):**
```bash
cd tools/seedgen
dotnet restore
dotnet run
dotnet test --nologo
```

## Architecture

### API Structure
- `app/main.py`: FastAPI app with CORS, startup logic, and endpoints
- `app/models.py`: Pydantic models for request/response schemas
- `app/planner.py`: Core trip planning logic
- Data loaded from `/app/data/index.json` (generated by seedgen)

### Key Endpoints
- `POST /itinerary/plan`: Main planning endpoint (see `PlanRequest` model)
- `GET /healthz`: Health check
- `GET /docs`: OpenAPI documentation

### Frontend Architecture
- Single-page app (`pages/index.tsx`) with JSON query textarea
- Minimal styling, focused on functionality
- API communication via `NEXT_PUBLIC_API` environment variable

### Data Flow
1. Seedgen processes `data/destinations.csv` â†’ `data/index.json`
2. API loads index on startup via `load_index()` function
3. Frontend sends JSON queries to `/itinerary/plan`
4. Planner processes queries against loaded destination data

## CI/CD Pipeline

The GitHub Actions workflow (`.github/workflows/ci.yml`) demonstrates JFrog integration:
- Dependency resolution via Artifactory (pip, npm, NuGet)
- Docker image builds with JFrog CLI
- SBOM generation (CycloneDX format)
- Image signing with Cosign
- Xray security scanning

**Important**: The pipeline includes intentional vulnerabilities (e.g., `requests==2.25.1`) for security tool demonstration.

## Security Context

This is a demo application with **intentional security issues** for testing DevSecOps tools. When working with this codebase:
- The vulnerable dependencies in `api/requirements.txt` are by design
- CORS is wide open (`allow_origins=["*"]`) for demo purposes
- Some configurations prioritize demonstration over production security

## Copilot Instructions

Key points from `copilot-instructions.md`:
- Focus on clean, simple UI design with responsive layout
- Use natural language chat interface for trip planning
- Display generated trip plans in real-time
- Three-tier architecture: Next.js frontend, Python FastAPI backend, .NET CLI tools
- Consistent color scheme and typography throughout